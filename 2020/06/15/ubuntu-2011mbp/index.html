<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Ubuntu 20.04 on MacBook Pro 2011 - a few notes</title>
  <meta name="description" content="setting up a functional ubuntu 20.04 on MacBook Pro 2011">
  <meta name="author" content="Sarang Baheti"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "a few notes",
    
    "url": "https:\/\/www.variadic.xyz\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/www.variadic.xyz\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/www.variadic.xyz\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/www.variadic.xyz\/2020\/06\/15\/ubuntu-2011mbp\/",
          "name": "Ubuntu 20.04 on mac book pro 2011"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Sarang Baheti"
  },
  "headline": "Ubuntu 20.04 on MacBook Pro 2011",
  "description" : "setting up a functional ubuntu 20.04 on MacBook Pro 2011",
  "inLanguage" : "en",
  "wordCount":  615 ,
  "datePublished" : "2020-06-15T00:00:00",
  "dateModified" : "2020-06-15T00:00:00",
  "image" : "https:\/\/www.variadic.xyz\/",
  "keywords" : [ "linux, mbp" ],
  "mainEntityOfPage" : "https:\/\/www.variadic.xyz\/2020\/06\/15\/ubuntu-2011mbp\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/www.variadic.xyz\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/www.variadic.xyz\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Ubuntu 20.04 on MacBook Pro 2011" />
<meta property="og:description" content="setting up a functional ubuntu 20.04 on MacBook Pro 2011">
<meta property="og:url" content="https://www.variadic.xyz/2020/06/15/ubuntu-2011mbp/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="a few notes" />

  <meta name="twitter:title" content="Ubuntu 20.04 on MacBook Pro 2011" />
  <meta name="twitter:description" content="setting up a functional ubuntu 20.04 on MacBook Pro 2011">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.73.0" />
  <link rel="alternate" href="https://www.variadic.xyz/index.xml" type="application/rss+xml" title="a few notes"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://www.variadic.xyz/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://www.variadic.xyz/css/syntax.css" /><link rel="stylesheet" href="https://www.variadic.xyz/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-27935503-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.variadic.xyz/">a few notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Notes" href="/">Notes</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Archive" href="/archive/">Archive</a>
            </li>
          
        
          
            <li>
              <a title="Books" href="/books/">Books</a>
            </li>
          
        
          
            <li>
              <a title="Disclaimer" href="/disclaimer/">Disclaimer</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Ubuntu 20.04 on MacBook Pro 2011</h1>
              
              
              
              
                <span class="post-meta">
  
  

  
    Posted on June 15, 2020
  

  
  
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">

      
      
        <div class="blog-tags">
          
            <a href="https://www.variadic.xyz//tags/linux/">linux</a>&nbsp;
          
            <a href="https://www.variadic.xyz//tags/mbp/">mbp</a>&nbsp;
          
        </div>
      

        
          
          

<p><a href="/2020/05/28/2011mbp-osx/">Previously</a>, i tried to use my MBP2011 functional, but seemed like linux could be a better fit as well. Thought of giving it a try (why not).</p>

<p>Ubuntu 20.04 just came out and installing it was just a breeze. I think there are ample or resources available that walk you thru how to create a bootable usb drive (efi based), so won&rsquo;t rehash here.</p>

<p><br/></p>

<h3 id="grub-customization">GRUB customization</h3>

<hr />

<p>Now, i did ensure that <code>nvram</code> had set up <code>gpu-power-prefs</code> correctly to always go with iGPU. Once installed now it was important to ensure that dGPU stayed off and did not kick in.</p>

<p>GRUB to rescue (more on GRUB later):</p>
<pre><code>sudo vim /etc/default/grub</code></pre>
<p>update <code>GRUB_CMDLINE_LINUX_DEFAULT</code> with following options. Here we are asking kernel to neglect radeon driver, even if it is found &amp; go with i915 (intel iGPU) instead.</p>
<pre><code>GRUB_DEFAULT=0
GRUB_TIMEOUT_STYLE=hidden
GRUB_TIMEOUT=0
GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`
GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet splash radeon.modeset=0 i915.lvds_channel_mode=2 i915.modeset=1&#34;
GRUB_CMDLINE_LINUX=&#34;&#34;</code></pre>
<p>Now this will just switch GPU, but will not power off dGPU. To achieve that:</p>
<pre><code>sudo vim /etc/grub.d/10_linux</code></pre>
<blockquote>
<p>more details here <a href="https://forums.macrumors.com/threads/installing-ubuntu-on-2011-mbp-with-failed-amd-gpu.2182103/">https://forums.macrumors.com/threads/installing-ubuntu-on-2011-mbp-with-failed-amd-gpu.2182103/</a></p>
</blockquote>

<p>It is important to add <code>outb</code> lines before <code>insmod gzio</code> (this is a grub thing). Basically GRUB will load (<code>insmod</code>) <code>gzio</code> before loading kernel (often linux kernel is compressed). Lines <code>6-9</code> are of interest here. After <code>GRUB_GFXPAYLOAD_LINUX</code> and before <code>insmod gzio</code>.</p>
<pre><code>if ([ &#34;$ubuntu_recovery&#34; = 0 ] || [ x$type != xrecovery ]) &amp;&amp; \
   ([ &#34;x$GRUB_GFXPAYLOAD_LINUX&#34; != x ] || [ &#34;$gfxpayload_dynamic&#34; = 1 ]); then
    echo &#34;    gfxmode \$linux_gfx_mode&#34; | sed &#34;s/^/$submenu_indentation/&#34;
fi

echo &#34;        outb 0x728 1&#34; | sed &#34;s/^/$submenu_indentation/&#34;
echo &#34;          outb 0x710 2&#34; | sed &#34;s/^/$submenu_indentation/&#34;
echo &#34;          outb 0x740 2&#34; | sed &#34;s/^/$submenu_indentation/&#34;
echo &#34;          outb 0x750 0&#34; | sed &#34;s/^/$submenu_indentation/&#34;
echo &#34;        insmod gzio&#34; | sed &#34;s/^/$submenu_indentation/&#34;</code></pre>
<p>Once done with updating grub config and files, ensure that you update grub:</p>
<pre><code>sudo update grub</code></pre>
<p>Now, the best part of this is dGPU is completely powered down. <a href="/2020/06/03/lmsensors-config/">Can be checked with <code>sensors</code> as installed with lm-sensors</a>. I can see that GPU-diode consistently reports either <code>-128</code> or low single digit numbers (as the heat sink is shared between both CPU &amp; dGPU). But overall MacBook is quite cool and does not heat up at all (to the point I don&rsquo;t even need a laptop cooler to use it :) ).</p>

<h4 id="a-note-about-previous-magic-numbers">A note about previous magic numbers:</h4>
<pre><code>outb 0x728 1 # Switch select
outb 0x710 2 # Switch display
outb 0x740 2 # Switch DDC
outb 0x750 0 # Power down discrete graphics</code></pre>
<p>Now, on every reboot this sets up well &amp; looks very usable overall. More details on how to do this <a href="/2020/06/28/switching-off-dgpu/">on resume after suspending here</a>.</p>

<p><br/></p>

<h3 id="setting-up-ubuntu">Setting up Ubuntu</h3>

<hr />

<p>I tried both <code>KDE</code> and <code>Gnome</code>. I found <code>Gnome</code> to be quite handy as compared to <code>KDE</code>. Matter of personal choice- both desktop envs are great. I like the typography as well. Anyway following packages are easily installed and used.</p>
<pre><code>sudo apt install hwinfo
sudo apt install lm-sensors
sudo apt install htop
sudo apt install git
sudo apt install ksysguard
sudo apt install tmux
sudo apt install powertop
sudo apt install smartmontools
sudo apt install okular
sudo apt install vim
sudo apt install psensor
sudo apt install nodejs
sudo apt install npm</code></pre>
<p>Goes without saying that I installed <code>VisualStudio Code</code> and <code>Brave/Chrome</code> browsers. But that is it really.</p>

<h2 id="br"><br/></h2>

<p>With all these setup, I found that <a href="/2020/06/08/disabling-turbo/">turning off turbo-boost</a> helped keep temperature in control. But the biggest benefit came by switching off dGPU (<code>outb</code> magic addresses).</p>

<p>With MacOS following things did not work, but they do now with Linux/Ubuntu:</p>

<ol>
<li>Screen Brightness buttons, work out of the box</li>
<li>Sleep, if I close the lid and reopen, computer wakes up and it is functional.</li>
<li>Updates/Upgrades, a few glitches but functional</li>
</ol>

<!--

//https://help.ubuntu.com/community/MacBookPro8-2/Raring

Booting from usb pen via EFI
To successfully boot via EFI we need to turn off the radeon card, since it won't be able to access the BIOS and will fail to load (error in dmesg: radeon 0000:01:00.0: Invalid ROM contents . To do this we need add some outb commands in GRUB and set some options:

Download the normal image and dd it onto your USB
During boot hold down the option key and select EFI boot ( USB Icon )
On GRUB edit the entry for ubuntu. Add the following after insmod ext2

//  https://github.com/blackgate/AMDGPUWakeHandler/blob/master/AMDGPUWakeHandler/AMDGPUWakeHandler.cpp
outb 0x728 1 # Switch select
outb 0x710 2 # Switch display
outb 0x740 2 # Switch DDC
outb 0x750 0 # Power down discrete graphics
Add after quiet splash -


    quiet splash i915.lvds_channel_mode=2 i915.modeset=1 i915.lvds_use_ssc=0
This will disable the radeon card and only use the integrated card. After the usb pen boots you should be able to install ubuntu. In order to then boot ubuntu from disk after installation you will need to change the GRUB entry on disk permanently to have the entries above. Probably the first time you boot you have to set make the changes in the GRUB by hand, and after you manage to login into ubuntu you can then make those changes permanent.


https://wiki.debian.org/InstallingDebianOn/Apple/MacBookPro/9-1
https://gist.github.com/cdleon/ae1542279598fe80f527400cc354a956
https://askubuntu.com/questions/92218/how-to-execute-a-command-after-resume-from-suspend
https://manpages.ubuntu.com/manpages/xenial/man8/pm-action.8.html


https://blog.christophersmart.com/2016/05/11/running-scripts-before-and-after-suspend-with-systemd/comment-page-1/
https://blog.christophersmart.com/2016/05/08/automatic-power-saving-on-a-linux-laptop-with-powertop-and-systemd/
https://stackoverflow.com/questions/42283324/waking-up-from-pm-suspend-results-in-full-restart


// boot with grub
https://www.linuxjournal.com/article/4622

// GRUB oreilly
https://www.oreilly.com/library/view/linux-in-a/0596004826/ch04s03.html

// GRUB manual
https://www.gnu.org/software/grub/manual/grub/grub.html#Introduction

-->

        
      
      <br/>
      
        <div class="blog-tags">
          
            <a href="https://www.variadic.xyz//tags/linux/">linux</a>&nbsp;
          
            <a href="https://www.variadic.xyz//tags/mbp/">mbp</a>&nbsp;
          
        </div>
      
        
        

        <hr>
        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/2020/07/01/grub-customizer/">grub customizer</a></li>
                
                    <li><a href="/2020/06/28/switching-off-dgpu/">swithcing off dGPU in MBP 2011</a></li>
                
                    <li><a href="/2020/06/21/offline-cpus/">swithcing off cpus</a></li>
                
                    <li><a href="/2020/06/19/ssh-terminate-remote-processes/">ssh terminate &amp; remote process</a></li>
                
                    <li><a href="/2020/06/08/disabling-turbo/">disabling turbo-bost</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://www.variadic.xyz/2020/06/08/disabling-turbo/" data-toggle="tooltip" data-placement="top" title="disabling turbo-bost">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://www.variadic.xyz/2020/06/19/ssh-terminate-remote-processes/" data-toggle="tooltip" data-placement="top" title="ssh terminate &amp; remote process">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Sarang Baheti
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://www.variadic.xyz/">a few notes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.73.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/sarangbaheti/beautifulhugo">beautifulhugo</a> forked from <a href="https://github.com/halogenica/beautifulhugo"> halogenica/Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://www.variadic.xyz/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://www.variadic.xyz/js/load-photoswipe.js"></script>









    
  </body>
</html>

