<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>A Guide to Undefined Behavior in C and C&#43;&#43; - a few notes</title>
  <meta name="description" content="a guide to undefined behavior">
  <meta name="author" content="Sarang Baheti"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "a few notes",
    
    "url": "https:\/\/www.variadic.xyz\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/www.variadic.xyz\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/www.variadic.xyz\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/www.variadic.xyz\/2011\/12\/30\/a-guide-to-undefined-behavior-in-c-and-c\/",
          "name": "A guide to undefined behavior in c and c\u002b\u002b"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Sarang Baheti"
  },
  "headline": "A Guide to Undefined Behavior in C and C\u002b\u002b",
  "description" : "a guide to undefined behavior",
  "inLanguage" : "en",
  "wordCount":  724 ,
  "datePublished" : "2011-12-30T00:00:00",
  "dateModified" : "2011-12-30T00:00:00",
  "image" : "https:\/\/www.variadic.xyz\/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/www.variadic.xyz\/2011\/12\/30\/a-guide-to-undefined-behavior-in-c-and-c\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/www.variadic.xyz\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/www.variadic.xyz\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="A Guide to Undefined Behavior in C and C&#43;&#43;" />
<meta property="og:description" content="a guide to undefined behavior">
<meta property="og:url" content="https://www.variadic.xyz/2011/12/30/a-guide-to-undefined-behavior-in-c-and-c/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="a few notes" />

  <meta name="twitter:title" content="A Guide to Undefined Behavior in C and C&#43;&#43;" />
  <meta name="twitter:description" content="a guide to undefined behavior">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.73.0" />
  <link rel="alternate" href="https://www.variadic.xyz/index.xml" type="application/rss+xml" title="a few notes"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://www.variadic.xyz/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://www.variadic.xyz/css/syntax.css" /><link rel="stylesheet" href="https://www.variadic.xyz/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-27935503-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.variadic.xyz/">a few notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Notes" href="/">Notes</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Archive" href="/archive/">Archive</a>
            </li>
          
        
          
            <li>
              <a title="Books" href="/books/">Books</a>
            </li>
          
        
          
            <li>
              <a title="Disclaimer" href="/disclaimer/">Disclaimer</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>A Guide to Undefined Behavior in C and C&#43;&#43;</h1>
              
              
              
              
                <span class="post-meta">
  
  

  
    Posted on December 30, 2011
  

  
  
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">

        
          <p style="text-align: justify;">
  Bumped into this nice article by <a href="http://blog.regehr.org/">John Regehr</a> about undefined behaviour in C and C++. The article is in three parts:
</p>

<ol>
<li><a href="http://blog.regehr.org/archives/213">A Guide to Undefined Behavior in C and C++ Part 1</a></li>
<li><a href="http://blog.regehr.org/archives/226">A Guide to Undefined Behavior in C and C++ Part 2</a></li>
<li><a href="http://blog.regehr.org/archives/232">A Guide to Undefined Behavior in C and C++ Part 3</a></li>
</ol>

<p><span style="font-size: x-small;"><br /> </span></p>

<blockquote>
<p style="text-align: justify;">
  Programming languages typically make a distinction between normal program actions and erroneous actions. For Turing-complete languages we cannot reliably decide offline whether a program has the potential to execute an error; we have to just run it and see.
</p>

<p style="text-align: justify;">
  In a <em>safe</em> programming language, errors are trapped as they happen. Java, for example, is largely safe via its exception system. In an <em>unsafe</em>programming language, errors are not trapped. Rather, after executing an erroneous operation the program keeps going, but in a silently faulty way that may have observable consequences later on. <a href="http://lucacardelli.name/Papers/TypeSystems.pdf">Luca Cardelli’s article on type systems</a> has a nice clear introduction to these issues. C and C++ are unsafe in a strong sense: executing an erroneous operation causes the entire program to be meaningless, as opposed to just the erroneous operation having an unpredictable result. In these languages erroneous operations are said to have <em>undefined behavior</em>.
</p>

<p style="text-align: justify;">
  
</p>

<p style="text-align: justify;">
  The C FAQ defines “undefined behavior” like this:
</p>

<p style="text-align: justify;">
  Anything at all can happen; the Standard imposes no requirements. The program may fail to compile, or it may execute incorrectly (either crashing or silently generating incorrect results), or it may fortuitously do exactly what the programmer intended.
</p>

<p style="text-align: justify;">
  This is a good summary. Pretty much every C and C++ programmer understands that accessing a null pointer and dividing by zero are erroneous actions. On the other hand, the full implications of undefined behavior and its interactions with aggressive compilers are not well-appreciated. This post explores these topics.
</p>

<h2 style="text-align: justify;">
  A Model for Undefined Behavior
</h2>

<p style="text-align: justify;">
  For now, we can ignore the existence of compilers. There is only the “C implementation” which — if the implementation conforms to the C standard — acts the same as the “C abstract machine” when executing a conforming program. The C abstract machine is a simple interpreter for C that is described in the C standard. We can use it to determine the meaning of any C program.
</p>

<p style="text-align: justify;">
  The execution of a program consists of simple steps such as adding two numbers or jumping to a label. If every step in the execution of a program has defined behavior, then the entire execution is well-defined. Note that even well-defined executions may not have a unique result due to unspecified and implementation-defined behavior; we’ll ignore both of these here.
</p>

<p style="text-align: justify;">
  If any step in a program’s execution has undefined behavior, then the entire execution is without meaning. This is important: it’s not that evaluating (1<<32) has an unpredictable result, but rather that the entire execution of a program that evaluates this expression is meaningless. Also, it’s not that the execution is meaningful up to the point where undefined behavior happens: the bad effects can actually precede the undefined operation.
</p>

<p style="text-align: justify;">
  As a quick example let’s take this program:
</p>

<pre class="brush: cpp; title: ; notranslate" title="">#include &lt;limits.h&gt;
#include &lt;stdio.h&gt;
int main()
{
    printf("%d\n", (INT_MAX+1) &lt; 0);
    return 0;
}
</pre>

<p style="text-align: justify;">
  The program is asking the C implementation to answer a simple question: if we add one to the largest representable integer, is the result negative? This is perfectly legal behavior for a C implementation:
</p>

<pre>$ cc test.c -o test $ ./test 1</pre>

<p style="text-align: justify;">
  So is this:
</p>

<pre>$ cc test.c -o test $ ./test 0</pre>

<p style="text-align: justify;">
  And this:
</p>

<pre>$ cc test.c -o test $ ./test 42</pre>

<p style="text-align: justify;">
  And this:
</p>

<pre>$ cc test.c -o test $ ./test Formatting root partition, chomp chomp</pre>

<p style="text-align: justify;">
  One might say: Some of these compilers are behaving improperly because the C standard says a relational operator must return 0 or 1. But since the program has no meaning at all, the implementation can do whatever it likes. Undefined behavior trumps all other behaviors of the C abstract machine.
</p>

<p style="text-align: justify;">
  Will a real compiler emit code to chomp your disk? Of course not, but keep in mind that practically speaking, undefined behavior often does lead to Bad Things because many security vulnerabilities start out as memory or integer operations that have undefined behavior. For example, accessing an out of bounds array element is a key part of the canonical stack smashing attack. In summary: the compiler does not need to emit code to format your disk. Rather, following the OOB array access your computer will begin executing exploit code, and that code is what will format your disk.
</p>
</blockquote>

<p style="text-align: justify;">
  <a href="http://blog.regehr.org/archives/213">Continue Reading at Source</a>
</p>

<h6 class="zemanta-related-title" style="font-size: 1em;">
  Related articles
</h6>

<ul >
  <li >
    <a href="http://stackoverflow.com/questions/7237963/a-c-implementation-that-detects-undefined-behavior">A C++ implementation that detects undefined behavior?</a> (stackoverflow.com)
  </li>
  <li >
    <a href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html">What every C programmer should know about undefined behaviour</a> (blog.llvm.org)
  </li>
</ul>

        


        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://www.variadic.xyz/2011/12/28/parallel-computing/" data-toggle="tooltip" data-placement="top" title="Parallel Computing">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://www.variadic.xyz/2012/01/04/enum-classes/" data-toggle="tooltip" data-placement="top" title="C&#43;&#43;11: enum classes">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Sarang Baheti
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://www.variadic.xyz/">a few notes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.73.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://www.variadic.xyz/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://www.variadic.xyz/js/load-photoswipe.js"></script>









    
  </body>
</html>

