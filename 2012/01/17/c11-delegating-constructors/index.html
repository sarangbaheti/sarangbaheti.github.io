<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>C&#43;&#43;11: delegating constructors</title>

  <meta name="author" content="Sarang Baheti" />
  
  

  <meta name="generator" content="Hugo 0.30.2" />

  <link rel="alternate" href="https://www.variadic.xyz/index.xml" type="application/rss+xml" title="a few notes">

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://www.variadic.xyz/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://www.variadic.xyz/css/main.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">
  
  
  
  <meta property="og:title" content="C&#43;&#43;11: delegating constructors" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/2012/01/17/c11-delegating-constructors//" />
  <meta property="og:image" content="" />
  
</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.variadic.xyz/">a few notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
          <a title="Notes" href="/">Notes</a>
  	      </li>
  	    
      
        
          <li>
          <a title="About" href="/about/">About</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Archive" href="/archive/">Archive</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Books" href="/books/">Books</a>
  	      </li>
  	    
      
        
          <li>
          <a title="Disclaimer" href="/disclaimer/">Disclaimer</a>
  	      </li>
  	    
      
      </ul>
    </div>

	<div class="avatar-container">
	  <div class="avatar-img-border">
      
	  </div>
	</div>

  </div>
</nav>


    <div role="main" class="container main-content">

      
        





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>C&#43;&#43;11: delegating constructors</h1>
      
      
      
      <span class="post-meta">Posted on January 17, 2012</span>
      
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
          

<h2 id="too-many-initializers-constructors">Too many initializers/constructors</h2>

<p style="text-align: justify;">
  It&#8217;s fairly common to write classes with multiple constructors, but they tend to get messy very soon. One of the biggest problems is initialization of the member variables. You, as programmer, need to ensure that member variables are initialized correctly in each constructor. Ensuring this consistency is quite tedious, boring and very easy to get wrong.
</p>

<p style="text-align: justify;">
  For example consider the class Sample:
</p>

<pre class="brush: cpp; title: ; notranslate" title="">class Sample
{
public:
    //
    //
    Sample() : r(0), i(0)
    {

    }
    //
    //
    Sample(double real) : r(real), i(0)
    {

    }
    //
    //
    Sample(double real, double img) : r(real), i(img)
    {

    }
    //
    //
    Sample(double data[2]) : r(data[0]), i(data[1])
    {

    }
    //
    //
    Sample(const Sample&) = default;
    Sample& operator=(const Sample&) = default;
    ~Sample() = default;
    //
private:
    double r;
    double i;
};
</pre>

<p style="text-align: justify;">
  Sample class has 4 constructors each initializing member variables r and i. It&#8217;s quite easy to forget to initialize these. Also the initializer code is also fairly repetitive, following the DRY (<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">Don&#8217;t Repeat Yourself</a>) principle it would be nice to abstract it out into a initializer method and then call this inside each constructor:
</p>

<pre class="brush: cpp; title: ; notranslate" title="">class Sample
{
private:
    void Init(double real, double img)
    {
        this-&gt;r = real;
        this-&gt;i = img;
    }
public:
    //
    //
    Sample()
    {
        Init(0,0);
    }
    //
    //
    Sample(double real)
    {
        Init(real,0);
    }
    //
    //
    ...
    //
    //
};
</pre>

<p style="text-align: justify;">
  This works and has been used by many C++ developers over decades however it gives up the benefits of initializing members in initializer list of constructor.
</p>

<h2 id="delegating-constructors">delegating constructors</h2>

<p style="text-align: justify;">
  In previous code sample the concise way of initializing objects of a class is to use a init method or to delegate the initialization of the member variables to a method but losing out on the initializer list benefits. This pattern is so useful that various new languages support this delegating construction out of box (C# has similar concept named <a href="http://www.codeproject.com/Articles/271582/Constructor-Chaining-in-Csharp">Constructor Chaining</a>). C++11 also voted on similar proposal of delegating constructors. With delegating constructors above code will look like:
</p>

<pre class="brush: cpp; highlight: [10,16,21,26]; title: ; notranslate" title="">class Sample
{
private:
    //
    // delegated constructor
    // it should cover the most general initialization
    // case and all other constructors will then call
    // this one to initialize the object
    //
    Sample(double real, double img) : r(real), i(img)
    {
    }
public:
    //
    //
    Sample() : Sample(0.0)
    {
    }
    //
    //
    Sample(double real) : Sample(real,0)
    {
    }
    //
    //
    Sample(double data[2]): Sample(data[0], data[1])
    {
    }
    //
    //
    Sample(const Sample&) = default;
    Sample& operator=(const Sample&) = default;
    ~Sample() = default;
    //
private:
    double r;
    double i;
};
</pre>

<p style="text-align: justify;">
  Constructor defined at Line 10 is the delegated constructor. And it is being delegated the task of constructing object by various constructors at line: 16, 21 and 26.
</p>

<p style="text-align: justify;">
  Default Constructor at Line 16 delegates construction to Constructor with one parameter, Line 21, which then delegates the construction to the private constructor with two parameters at Line 10.
</p>

<p style="text-align: justify;">
  Few things to note about delegating constructors (please refer the paper <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1986">N1986</a> for details):
</p>

<p><li style="text-align: justify;">
  you cannot initialize any member variable along with delegating constructor
</li>
<li style="text-align: justify;">
  delegating constructor can delegate to other constructor as well, however it is developer&#8217;s responsibility to ensure there are no cycles in delegation
</li>
<li style="text-align: justify;">
  behaviour while failure to construct object will remain unchanged, as we are initializing any member variable only once (pt 1)
</li></p>

<h2 style="text-align: justify;">
  Summary
</h2>

<p style="text-align: justify;">
  Concept of delegating constructor is very simple to understand and use. This feature is mostly syntactic sugar with some validation, but a big win when it comes to usability and writing cleaner code with C++ language.
</p>

<h6 class="zemanta-related-title" style="font-size: 1em;">
  Related articles
</h6>

<ul class="zemanta-article-ul">
  <li class="zemanta-article-ul-li">
    <a href="/2012/01/05/c11-defaulted-and-deleted-functions/">C++11: defaulted and deleted functions</a> 
  </li>
  <li class="zemanta-article-ul-li">
    <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1986">N1986: Delegating Constructors</a> (www.open-std.org)
  </li>
</ul>

      </article>

      <ul class="pager blog-pager">
        
        <li class="previous">
          <a href="https://www.variadic.xyz/2012/01/07/c-template-metaprogramming/" data-toggle="tooltip" data-placement="top" title="C&#43;&#43; Template Metaprogramming">&larr; Previous Post</a>
        </li>
        
        
        <li class="next">
          <a href="https://www.variadic.xyz/2012/01/22/delete-user-caches-in-mac-os-x/" data-toggle="tooltip" data-placement="top" title="Delete User Caches in Mac OS X">Next Post &rarr;</a>
        </li>
        
      </ul>

      

    </div>
  </div>
</div>

      

    </div>

    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          
          <li>
            <a href="https://github.com/sarangbaheti" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		      
		      
          <li>
            <a href="https://linkedin.com/in/sarangbaheti" title="LinkedIn">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
	    	  
          <li>
            <a href="https://stackoverflow.com/users/916549/sarang" title="StackOverflow">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
    		  <li>
      			<a href="https://www.variadic.xyz/index.xml" title="RSS">
      			  <span class="fa-stack fa-lg">
        				<i class="fa fa-circle fa-stack-2x"></i>
        				<i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      			  </span>
      			</a>
    		  </li>		

        </ul>
        <p class="copyright text-muted">
    		  Sarang Baheti
    		  &nbsp;&bull;&nbsp;
    		  2020
    		  
    		  
    		  &nbsp;&bull;&nbsp;
    		  <a href="https://www.variadic.xyz/">a few notes</a>
    		  
  	    </p>
  	        
    		<p class="theme-by text-muted">
    		  Theme by
    		  <a href="https://github.com/sarangbaheti/bh">bh</a>
    		</p>
      </div>
    </div>
  </div>
</footer>

<script src="https://www.variadic.xyz/js/jquery-1.11.2.min.js"></script>
<script src="https://www.variadic.xyz/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
<script src="https://www.variadic.xyz/js/main.js"></script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27935503-1', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
