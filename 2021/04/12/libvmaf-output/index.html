<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>vmaf output - a few notes</title><meta name=description content="couple of points about libvmaf output"><meta name=author content="Sarang Baheti"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"a few notes","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.variadic.xyz\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.variadic.xyz\/2021\/04\/12\/libvmaf-output\/","name":"Vmaf output"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Sarang Baheti"},"headline":"vmaf output","description":"couple of points about libvmaf output","inLanguage":"en","wordCount":465,"datePublished":"2021-04-12T00:00:00","dateModified":"2021-04-12T00:00:00","image":"https:\/\/www.variadic.xyz\/","keywords":["misc, linux"],"mainEntityOfPage":"https:\/\/www.variadic.xyz\/2021\/04\/12\/libvmaf-output\/","publisher":{"@type":"Organization","name":"https:\/\/www.variadic.xyz\/","logo":{"@type":"ImageObject","url":"https:\/\/www.variadic.xyz\/","height":60,"width":60}}}</script><meta property="og:title" content="vmaf output"><meta property="og:description" content="couple of points about libvmaf output"><meta property="og:url" content="https://www.variadic.xyz/2021/04/12/libvmaf-output/"><meta property="og:type" content="website"><meta property="og:site_name" content="a few notes"><meta name=twitter:title content="vmaf output"><meta name=twitter:description content="couple of points about libvmaf output"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.73.0"><link rel=alternate href=https://www.variadic.xyz/index.xml type=application/rss+xml title="a few notes"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.variadic.xyz/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.variadic.xyz/css/syntax.css><link rel=stylesheet href=https://www.variadic.xyz/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-27935503-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://www.variadic.xyz/>a few notes</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Notes href=/>Notes</a></li><li><a title=About href=/about/>About</a></li><li><a title=Archive href=/archive/>Archive</a></li><li><a title=Books href=/books/>Books</a></li><li><a title=Disclaimer href=/disclaimer/>Disclaimer</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>vmaf output</h1><span class=post-meta>Posted on April 12, 2021</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><div class=blog-tags><a href=https://www.variadic.xyz//tags/misc/>misc</a>&nbsp;
<a href=https://www.variadic.xyz//tags/linux/>linux</a>&nbsp;</div><p>In <a href=/2021/04/11/libvmaf-hevc/>previous post</a>, I went about calculating vmaf for my encodes. However, couple of points for my reference with respect to output files.<br><br>The output file generated from command</p><pre><code>ffmpeg -i &lt;tocheck.mp4&gt; -i &lt;ref.mp4&gt; -lavfi libvmaf=&#34;n_threads=4:model_path=./vmaf_v0.6.1.json:log_fmt=json:ssim=1:log_path=./vmaf.txt:psnr=1:ssim=1&#34; -f null -</code></pre><p><br>looks like this (json format):</p><pre><code>{
  &#34;version&#34;: &#34;2.1.1&#34;,
  &#34;frames&#34;: [
    {
      &#34;frameNum&#34;: 0,
      &#34;metrics&#34;: {
        &#34;integer_motion2&#34;: 0.000000,
        &#34;integer_motion&#34;: 0.000000,
        &#34;ssim&#34;: 0.999468,
        ...
        &#34;vmaf&#34;: 98.682631
      }
    },
    ...
    ...
    }
  ],
    &#34;pooled_metrics&#34;: {
    ...
    &#34;ssim&#34;: {
      &#34;min&#34;: 0.980323,
      &#34;max&#34;: 1.000000,
      &#34;mean&#34;: 0.996725,
      &#34;harmonic_mean&#34;: 0.996724
    },
    ...
    ...
    &#34;vmaf&#34;: {
      &#34;min&#34;: 90.401109,
      &#34;max&#34;: 100.000000,
      &#34;mean&#34;: 97.782800,
      &#34;harmonic_mean&#34;: 97.748271
    }
  },
  &#34;aggregate_metrics&#34;: {
  }
}</code></pre><p><br>There is per-frame data and towards the end is <code>pooled-metrics</code>. If one looks at <code>ssim</code>, it lists two fields: <code>mean</code> and <code>harmonic-mean</code>, similarly for <code>vmaf</code>.<br>Here <code>mean</code> is just an average over all frames. This is not necessarily the indicator of high quality encode. In case a few frames were encoded with lower score, they will be neglected with most of the higher scored ones. However, this is fine for most encodings, as <code>mean</code> weighs each frame score equally. Now, <code>harmonic_mean</code> brings another twist where it weighs frames with lower score more and will reduce the aggregate value in case of significant deviation.<br>This is one of the cases, where <code>ssim</code> could be near perfect but <code>vmaf/harmonic_mean</code> would be much lower. Discussion in <a href=https://github.com/Netflix/vmaf/blob/master/FAQ.md>github/netflix/vamf/FAQs</a> is quite good and brings about these things.</p><p>A note from <a href=https://blog.twitter.com/engineering/en_us/topics/infrastructure/2020/introducing-vmaf-percentiles-for-video-quality-measurements.html>twitter about encodings & quality</a> along similar lines:</p><pre><code>As discussed on [VMAF GitHub](https://github.com/Netflix/vmaf/blob/master/FAQ.md#q-why-the-aggregate-vmaf-score-sometimes-may-bias-easy-content-too-much-issue-20), aggregating VMAF scores of frames by averaging over the entire sequence may hide the impact of difficult-to-encode frames (if these frames occur infrequently). An optimal way to pool frames is an open problem. For example, VMAF tools can already aggregate harmonic mean and output one percentile score. In the context of this blog, after calculating VMAF scores of all frames of a sequence, we compute the 1st, 5th, 10th, 25th, and 50th percentiles. By definition, the 5th percentile gives us a VMAF score of the worst 5% frames while the 50th percentile is the median. The intuition here is that instead of weighing all frames equally and getting one score, we rank frames according to their complexity and look at how a particular encoder setting performs across these different ranks. We want to prioritize improving quality on frames in the order of their VMAF scores, from lowest to highest. Frames with a high VMAF score already look great and improving quality on them won’t matter as much.</code></pre><hr><p>A few links of interest:</p><ul><li><a href=https://streaminglearningcenter.com/video-encoding-by-the-numbers>https://streaminglearningcenter.com/video-encoding-by-the-numbers</a></li><li><a href=https://www.reddit.com/r/ffmpeg/comments/hu4xkf/a_small_amount_of_data_related_to_encoding_time/>https://www.reddit.com/r/ffmpeg/comments/hu4xkf/a_small_amount_of_data_related_to_encoding_time/</a></li><li><a href="https://www.streamingmedia.com/Articles/ReadArticle.aspx?ArticleID=128457">https://www.streamingmedia.com/Articles/ReadArticle.aspx?ArticleID=128457</a></li></ul><p><br>A few youtube videos:</p><ul><li><a href="https://www.youtube.com/watch?v=7qWSleAyJMI">VMAF: the Journey Continues, 2018</a></li><li><a href="https://www.youtube.com/watch?v=s-xUrqTztBQ">VMAF: The Journey Continues, 2020</a></li><li><a href="https://www.youtube.com/watch?v=tQrsz3BrfwU">Netflix&rsquo;s Video Workflow</a></li><li><a href="https://www.youtube.com/watch?v=oGc61lx5A7Q">H.265 vs. H.264: Choosing the Best Options</a></li><li><a href="https://www.youtube.com/watch?v=sB66Y_aE-58">Understanding the Significance of HEVC/H.265</a></li><li><a href="https://www.youtube.com/watch?v=TLNkK5C1KN8">HEVC/H.265 Video Coding Standard: Part 1</a></li><li><a href="https://www.youtube.com/watch?v=V6a1AW5xyAw">HEVC/H.265 Video Coding Standard: Part 2</a></li></ul><br><div class=blog-tags><a href=https://www.variadic.xyz//tags/misc/>misc</a>&nbsp;
<a href=https://www.variadic.xyz//tags/linux/>linux</a>&nbsp;</div><hr></article><ul class="pager blog-pager"><li class=previous><a href=https://www.variadic.xyz/2021/04/11/libvmaf-hevc/ data-toggle=tooltip data-placement=top title="using vmaf for encoder quality">&larr; Previous Post</a></li><li class=next><a href=https://www.variadic.xyz/2021/04/26/diskpart-format-chkdsk/ data-toggle=tooltip data-placement=top title="diskpart format & check disk">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">Sarang Baheti
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://www.variadic.xyz/>a few notes</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.73.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/sarangbaheti/beautifulhugo>beautifulhugo</a> forked from <a href=https://github.com/halogenica/beautifulhugo>halogenica/Beautiful Hugo</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://www.variadic.xyz/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.variadic.xyz/js/load-photoswipe.js></script></body></html>